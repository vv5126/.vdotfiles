#!/bin/bash

trap "set +f" 1 2 3 15; set -f

source $VLIBS/lib.base
source $VLIBS/lib.list

[ -z "$VUSER_DATA/sync.conf" ] && { echo "no conf file!"; exit; }

if [ $# -eq 1 ]; then
	expr $1 + 0 &>/dev/null
	[ $? -eq 0 ] && vconf -r "$1" -f $VUSER_DATA/sync.conf
else
	showlist_with_tab $VUSER_DATA/sync.conf "name" "Backup you want"
fi

if [ "${name-"null"}" != "null" ]; then
	eval src=$src
	eval dst=$dst
	if [ "$exclude" == '*' ]; then
		exclude=''
	elif [ -f "$exclude" ]; then
		exclude=" --exclude-from=$exclude"
	else
		exclude=" --exclude=$exclude"
	fi

	if [ "$(is_exsit $src)" -eq 1 -a "$(is_exsit $dst)" -eq 1 ]; then
		rsync -$param $exclude "$src" "$dst"
	else
		echo "dir error!"
	fi
else
	echo "wrong number"
	echo 
fi
