#!/bin/bash

source ~/.bin/lib/lib.list

DEST=0
APP_DIR=$(which $0)
APP_DIR=${APP_DIR%\/*}

if [ $# -eq 1 ]; then
	expr $1 + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		DEST=$(getline $APP_DIR/.mnt_conf $1)
	fi
else
	DEST=$(showlist_with_tab $APP_DIR/.mnt_conf 4 "go where ??")
fi

if [ "$DEST" != 0 ]; then
	mnt_type="$(echo $DEST | awk '{print $1}')"
	src="$(echo $DEST | awk '{print $2}')"
	dest="$(echo $DEST | awk '{print $3}')"
	case $mnt_type in
	'sshfs')
        mount | grep "$src on $dest" - > /dev/null
        if [ $? = 0 ]; then
            echo 'user' | sudo fusermount -u $dest 2>/dev/null
            [ $(ls $dest|wc -l)  == "0" ] && sudo rm -rf $dest
        else
		    if [ -d $dest ]; then
                [ $(ls $dest|wc -l)  != "0" ] && { echo "the dest dir isn't empty!"; exit 1; }
            else
                sudo mkdir -p $dest
            fi
			echo 'user' | sudo sshfs $src $dest -o uid=1000,gid=1000,allow_other || sudo rm -rf $dest
	    fi
		;;
	'win')
        mount | grep "$src on $dest" - > /dev/null
        if [ $? = 0 ]; then
			echo 'user' | sudo umount $dest 2>/dev/null
            [ $(ls $dest|wc -l)  == "0" ] && sudo rm -rf $dest
	    else
		    if [ -d $dest ]; then
                [ $(ls $dest|wc -l)  != "0" ] && { echo "the dest dir isn't empty!"; exit 1; }
            else
                sudo mkdir -p $dest
            fi
			echo 'user' | sudo mount -t cifs $src $dest -o username=wgao_bj,rw,dir_mode=0777,file_mode=0777 || sudo rm -rf $dest
        fi
		;;
	esac
#	echo DEST = $DEST
else
	echo "wrong number"
	echo 
fi


