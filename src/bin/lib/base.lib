#!/bin/bash

function quickcd() {
	[ "$#" -eq 0 -o -d "$1" ] && cd $1 || {
		[ $1 = "-" ] && { cd $OLDPWD; return; }
		[ $1 = "clean" ] && > ~/.cdlist
		[ $# -eq 2 ] && [ $1 = "add" ] && { echo "$2 `pwd`" >> ~/.cdlist; return; }
		while read line; do
			[ $1 = "${line% *}" ] && { cd ${line#* }; return; }
		done < ~/.cdlist
	}
}


function quickcd_old() {
	local NAME=''
	local DIR=''
	[ "$#" -eq 0 -o -d "$1" ] && cd $1 || {
		[ $# -eq 2 ] && [ $1 = "add" ] && { echo "$2 `pwd`" >> ~/.cdlist; return; }
		while read line; do
			NAME=${line% *}
			[ $1 = "$NAME" ] && {
				DIR=${line#* }
				cd $DIR
				return
			}
		done < ~/.cdlist
	}
}


function is_local() {
	para=$*

	if [[ "$para" =~ "@" ]] && [[ "$para" =~ ":" ]]; then
		return 1
	else
		return 0
	fi
}


function anymkdir() {
	dst=$1

	is_local $dst
	if [ $? = 0 ]; then
		mkdir -p $dst
	else
		ssh ${dst%:*} "[ -d "${dst##*:}" ] || mkdir -p ${dst##*:}"
	fi
}


function anyrm() {
	src=$*

	for i in "$src"; do
		is_local $i
		if [ $? = 0 ]; then
			rm -rf $i
		else
			ssh ${i%:*} "rm ${i##*:}"
		fi
	done

}


function anymv() {
	para=$*
	src=${para% *}
	dst=${para##* }

	is_local $para
	if [ $? = 0 ]; then
		is_local $dst
		if [ $? = 0 ]; then
			ssh ${dst%:*} "[ -d "${dst##*:}" -o -f "${dst##*:}" ] || mkdir -p ${dst##*:}"
		else
			[ -d "$dst" -o -f "$dst" ] || mkdir -p $dst
		fi
		scp -r "$src" "$dst" && anyrm "$src"
	else
		cp -r "$src" "$dst" && anyrm "$src"
	fi
}


function anycp() {
	para=$*
	src=${para% *}
	dst=${para##* }

	is_local $para
	if [ $? = 0 ]; then
		is_local $dst
		if [ $? = 0 ]; then
			ssh ${dst%:*} "[ -d "${dst##*:}" -o -f "${dst##*:}" ] || mkdir -p ${dst##*:}"
		else
			[ -d "$dst" -o -f "$dst" ] || mkdir -p $dst
		fi
		scp -r "$src" "$dst"
	else
		cp -r "$src" "$dst"
	fi
}


function read_key() {
	local key=$1
	local table=$2

	if [ -f "$table" ]; then
		while read line; do
			if [ "$key" = "${line%=*}" ]; then
				echo "${line#*=}"
				break
			fi
		done < "$table"
	fi
}

############# will export ##############

export -f is_local
export -f anymkdir
export -f anyrm
export -f anymv
export -f anycp
export -f read_key

########### will export end ############
