#!/bin/bash

#showlist file title
function showlist(){
	local NUM=0
	local NO=0
	local DEST=''
	local maybe_num=${@##* }

	expr $maybe_num + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		NUM=$maybe_num
	else
		echo >&2
		NO=1
		while read line; do
			if [ -n "$line" ]; then
				echo -e "  \e[40;33m$NO\033[0m >> \033[40;32m$line\033[0m">&2
				NO=$[$NO+1]
			fi
		done < "$1"
		echo -en "\n  $2  >>> ">&2
		read NUM
	fi

	echo >&2

	expr $NUM + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		NO=1
		while read line; do
			if [ -n "$line" ]; then
				if [ $NUM -eq $NO ]; then
					DEST=$line
					break
				fi
				NO=$[$NO+1]
			fi
		done < "$1"
	fi
	[ -n "$DEST" ] && echo $DEST || echo 0
}

function onlyshowlist(){
	echo >&2
	NO=1
	while read line; do
		if [ -n "$line" ]; then
			echo -e "  \e[40;33m$NO\033[0m >> \033[40;32m$line\033[0m">&2
			NO=$[$NO+1]
		fi
	done < "$1"
	echo >&2
}

function addlist(){
	local lastargs=${!#}
	while [ $# -gt 1 ]; do
		echo $1 >> $lastargs
		shift
	done
}

function getline(){
	echo $(head -$2 $1 | tail -1)
}

function showlist_with_value(){
	local NUM=0
	local NO=0
	local DEST=''
	local maybe_num=${@##* }

	expr $maybe_num + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		NUM=$maybe_num
	else
		echo >&2
		NO=1
		while read line; do
			if [ -n "$line" ]; then
				line=${line%%=*}
				echo -e "  \e[40;33m$NO\033[0m >> \033[40;32m$line\033[0m">&2
				NO=$[$NO+1]
			fi
		done < "$1"
		echo -en "\n  $2  >>> ">&2
		read NUM
	fi

	echo >&2

	expr $NUM + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		NO=1
		while read line; do
			if [ -n "$line" ]; then
				if [ $NUM -eq $NO ]; then
					line=${line#*=}
					DEST=$line
					break
				fi
				NO=$[$NO+1]
			fi
		done < "$1"
	fi
	[ -n "$DEST" ] && {
		echo $DEST
		return 0
	} || return 1
}

function user_select() {
	local NUM=0
	local NO=0
	local DEST=
	local value=
	local info=$1

	shift
	echo >&2
	NO=1
	for value in $@; do
		echo -e "  \e[40;33m$NO\033[0m >> \033[40;32m$value\033[0m">&2
		NO=$[$NO+1]
	done
	echo -en "\n  $info  >>> ">&2
	read NUM

	expr $NUM + 0 &>/dev/null
	if [ $? -eq 0 ]; then
		NO=1
		for value in $@; do
			if [ $NUM -eq $NO ]; then
				DEST=$value
				break
			fi
			NO=$[$NO+1]
		done
	fi
	[ -n "$DEST" ] && echo $DEST || echo 0
}


############# will export ##############

export -f showlist
export -f onlyshowlist
export -f addlist
export -f getline
export -f showlist_with_value
export -f user_select

########### will export end ############
