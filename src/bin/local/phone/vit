#!/bin/bash

dir='.vit'

function getTiming(){
        start=$1
        end=$2
        echo $start
        echo $end

        start_s=`echo $start | cut -d '.' -f 1`
        start_ns=`echo $start | cut -d '.' -f 2`
        end_s=`echo $end | cut -d '.' -f 1`
        end_ns=`echo $end | cut -d '.' -f 2`

        time_micro=$(( (10#$end_s-10#$start_s)*1000000 + (10#$end_ns/1000 - 10#$start_ns/1000) ))
        time_ms=`expr $time_micro/1000  | bc `

        echo "$time_micro microseconds"
        echo "$time_ms ms"
}

# name size md5 path

function make_recoder(){
        local log=
        local tmp=
        log=1.log
        # log=$dir/$(date +%Y%m%d_%H-%M).log
        tmp=$dir/.tmp

        local name=
        local size=
        local md5=
        local path=

        > $tmp
        > $log

        find . -type f ! -path "./$dir/*" > $tmp
        while read line; do
                if [ -f "$line" ]; then
                        name=${line##*\/}
                        path=${line%\/*}
                        # size="$(ls -l $line |cut -d " " -f5)"
                        # size="$(wc -c $line | awk '$2="";1')"
                        # size="$(ls -l $line | awk '{print $5}')"
                        size="$(stat -c %s $line)"
                        # md5=$(md5sum $line | awk {'print $1'})

                        # echo line = $line
                        # echo name = $name
                        # echo size = $size
                        # echo path = $path
                        # echo md5  = $md5

                        echo "$name"' | '"$size"' | '"$md5"' | '"$path" >> $log
                fi
        done < $tmp
        rm -f $tmp
        echo done~

}


function init(){
        [ ! -d "$dir" ] && mkdir "$dir"
        begin_time=`date +%s.%N`
        make_recoder
        end_time=`date +%s.%N`
        getTiming $begin_time $end_time
}

[ "$#" -ge 1 ] && {
	case "$1" in
	'init')
		init
		;;
	'up')
		;;
	'add')
		;;
	'rm')
		;;
        'status')
                ;;
	*)
		;;
	esac
} || {
        echo "vit xxx"
}
