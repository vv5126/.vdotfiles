#!/bin/bash

VGL_NOTIFY=/tmp/.notify_pipe

getmail_dir="/home/user/.getmail"
dir="$getmail_dir/maildir"
rc="$getmail_dir/getmailrc"

[ ! -d "$dir" ] && {
    mkdir -p "$dir/new"
    mkdir -p "$dir/cur"
    mkdir -p "$dir/tmp"
}

rm "$dir"/new/*

cat > "$rc" << EOF

[retriever]
type = SimplePOP3Retriever
server = mail.ingenic.com
username = wei.gao@ingenic.com
password = asd123456

[destination]
type = Maildir
path = ~/.getmail/maildir/
user = user

[options]
read_all = False
delete = False
EOF

getmail --rcfile=getmailrc

rm "$rc"

l_fileCount=`ls "$dir" | wc -l`
echo "fileCount: ${l_fileCount}"

[ "$l_fileCount" -gt "0" ] && echo "收到新邮件!" > "$VGL_NOTIFY"
