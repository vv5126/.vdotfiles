#!/bin/bash

VGL_NOTIFY=/tmp/.vpipe

getmail_dir="/home/user/.getmail"
dir="$getmail_dir/maildir"
rc="$getmail_dir/getmailrc"
check_dir="$dir/new"

[ ! -d "$dir" ] && {
    mkdir -p "$check_dir"
    mkdir -p "$dir/cur"
    mkdir -p "$dir/tmp"
}

rm "$check_dir"/* 2> /dev/null

cat > "$rc" << EOF

[retriever]
type = SimplePOP3Retriever
server = mail.ingenic.com
username = wei.gao@ingenic.com
password = asd123456

[destination]
type = Maildir
path = $dir/
user = user

[options]
read_all = False
delete = False
EOF

getmail -v --rcfile=getmailrc

rm "$rc"

l_fileCount=`ls "$check_dir" | wc -l`
echo "fileCount: ${l_fileCount}"

tmp='tasktype=notify\n'
tmp=$tmp'title=收到新邮件!'

[ "$l_fileCount" -gt "0" ] && echo "$tmp" > "$VGL_NOTIFY"
