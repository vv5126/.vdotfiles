#!/bin/bash

bak_list=(
.bin
.profile
.bashrc
.bash_logout
.vimrc
.vim
.gitconfig
.emacs
.emacs.d
.tmux.conf
)

[ "soft-4" != "$HOSTNAME" ] && {
	[ $# -eq 1 ] && [ -f $1 ] && up_config=$1 || up_config=$(ls ~/ bak_conf_* -1t | head -1 &2>/dev/null)
	[ -n "$up_config" ] && {
		[ -d .up ] && rm -rf .up
		mkdir .up
		tar -xf $up_config -C .up  2>/dev/null
		cd .up/$(ls .up)/ && FILES=$(ls -a) && FILES=${FILES:5}
		[ -n "$FILES" ] && {
			for i in ${bak_list[@]}
			do
				[ -d ~/$i -o -f ~/$i ] && rm -rf ~/$i
			done
			cp -rf $FILES ~/
			cd ../../
			rm -rf .up $up_config
			echo up done
		}
	}
	exit
}

DATE=$(date +%Y-%m-%d_%H-%M)
DIR=bak_conf_$DATE
FILE=bak_conf_$DATE.tar.gz

cd ~/.bak/
mkdir $DIR
cd $DIR

for i in ${bak_list[@]}
do
	[ -d ~/$i -o -f ~/$i ] && {
	cp -r ~/$i . && echo bak $i OK || echo bak $i Fail
	} || {
		echo Can\'t find $i !
	}
done

cd ../

tar -zcf $FILE -h $DIR

rm -rf $DIR

echo 
scp $FILE wgao@192.168.4.4:~
scp $FILE user@192.168.4.150:~
scp $FILE wgao@192.168.4.15:~
scp $FILE user@192.168.4.150:~/vtools/vconf
echo 
echo bak ok
echo 
