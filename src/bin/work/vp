#!/bin/bash

host=user@192.168.4.150

function push_to_board() {
    local src=$1
    local dst=$2
    local file=${src##*/}
    local local_home=$(ssh $host "pwd")

    # scp $1 $host:~ > /dev/null
    scp $src $host:/tmp > /dev/null

    ssh $host "$local_home/.vdotfiles/src/bin/local/adb remount" > /dev/null 2>&1
    # ssh $host "$local_home/.vdotfiles/src/bin/local/adb push $local_home/$file $dst" > /dev/null 2>&1
    ssh $host "$local_home/.vdotfiles/src/bin/local/adb push /tmp/$file $dst" > /dev/null 2>&1
    ssh $host "$local_home/.vdotfiles/src/bin/local/adb shell sync" > /dev/null 2>&1
    ssh $host "rm /tmp/$file" > /dev/null 2>&1
}


[ $# -eq 0 -o $# -gt 2 ] && exit

if [ $# -eq 1 ]; then
    if [[ "$1" =~ 'system' ]]; then
        file="$(getdir .repo)/$1"
        dir="/${1##*/system/}"
        [ -d "./cts" ] && dir="/system/${dir%/*}" # for android

        push_to_board "$file" "$dir"
        [ $? == 0 ] && echo done
    fi
elif [ $# -eq 2 ]; then
    push_to_board "$1" "$2"
    [ $? == 0 ] && echo done
fi
