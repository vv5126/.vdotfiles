#!/bin/bash
set -o nounset                              # Treat unset variables as an error

function vadb(){
    ssh user@192.168.4.150 "/home/user/.bin/local/adb $@"
}

dir_list=(
/system/lib
/system/bin
/data
)

[ $1 == 'root' ] && {
    vadb root
    vadb remount
    shift
}

for target in $@; do
    target_dir=
    whole_path=$PWD/${target%*\/}
    target=${target##*\/}

    # echo the file is $target
    [ -f "$whole_path" -o -d "$whole_path" ] || continue

    scp -r "$whole_path" "user@192.168.4.150:/tmp/$target" > /dev/null
    [ $? != 0 ] && exit

    for dir in "${dir_list[@]}"; do
        [[ "$whole_path" =~ "$dir/$target" ]] && { target_dir=$dir; break; }
    done
    [ "x$target_dir" == "x" ] && target_dir=$dir

    echo -n "the target dir is $target_dir >>> "
    vadb push "/tmp/$target" $target_dir/$target
    vadb shell sync
done
