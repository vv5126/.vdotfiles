#!/bin/bash
set -o nounset                              # Treat unset variables as an error

function vadb(){
    ssh user@192.168.4.150 "/home/user/.bin/local/adb $@"
}

dir_list=(
/system/lib
/system/bin
/data
)

[ $1 == 'root' ] && {
    vadb root
    vadb remount
    shift
}

for target in $@; do
    target=${target%*\/}

    # echo the file is $target
    [ -f "$PWD/$target" -o -d "$PWD/$target" ] || continue

    scp -r "$PWD/$target" "user@192.168.4.150:/tmp/$target" > /dev/null
    [ $? != 0 ] && exit

    for dir in $dir_list; do
        [[ "$PWD/$target" =~ "$dir/$target" ]] && { target_dir=$dir; break; }
    done
    [ -n "$target_dir" ] && target_dir=$dir

    echo the target dir is $target_dir
    vadb push "/tmp/$target" $target_dir/$target
done
