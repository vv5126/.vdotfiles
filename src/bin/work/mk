#!/bin/bash

function mkinit()
{
	DEST=$(showlist_with_value "$VGLD_MKDATA/cfg" "what project type do you want init")
	[ $? = 0 ] && { [ ! -f ".$DEST" ] && cp "$VGLD_MKDATA/$DEST" ".$DEST"; } || return 1
	./".$DEST" init
	[ $? = 0 ] && return 0 || return 1
}

function mkmain() {
	local PROJECT_TYPE=$(getdir_git_repo | awk '{print $1}')
	local PROJECT_DIR=$(getdir_git_repo | awk '{print $2}')

	[ -n "$PROJECT_TYPE" -a -n "$PROJECT_DIR" ] && cd $PROJECT_DIR

	if [ ! -f ".project_info" ]; then
		mkinit && echo "init ok" >&2
		return 0
	fi

	local value=
	local key=
	while read line; do
		if [ -f ".${line#*=}" ]; then
			value=".${line#*=}"
			key=${line%%=*}
			break
		fi
	done < "$VGLD_MKDATA/cfg"

	if [ -n "value" ]; then
		echo "this's maybe a $key project" >&2
		./$value $@
		return 0
	else
		echo "NO PROJECT DIR" >&2
		return 1
	fi
}

mkmain $@
