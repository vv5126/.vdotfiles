#!/bin/bash -x

APP_DIR=$(which $0)
APP_DIR=${APP_DIR%\/*}

LIBCONF=

function get_num_left() {
	local num
	num=`echo "$1" | tr -cd '{' | wc -c`
	echo $num
}

function get_num_right() {
	local num
	num=`echo "$1" | tr -cd '}' | wc -c`
	echo $num
}


if [ $# = 1 ]; then
	[ -f $1 ] && LIBCONF=$1
fi

num_tmp=0
num_left=0
num_right=0
while read line; do
	while read line; do
#		echo line $line
		if [ $num_left = 0 ]; then
			[[ $line =~ "=" ]] && echo will export $line
			if [[ $line =~ "function" ]]; then
				func=${line##*function }
				func=${func%(*}
				echo will export -f $func
			fi
		else
			if [ $num_left = $num_right ]; then
				num_left=0
				num_right=0
			fi
		fi
		num_tmp=$(get_num_left "$line")
#		echo left get $num_tmp
		num_left=$[$num_left+$num_tmp]
		num_tmp=$(get_num_right "$line")
#		echo right get $num_tmp
		num_right=$[$num_right+$num_tmp]
#		echo num_left = $num_left, num_right = $num_right
	done < "$line"
done < "$LIBCONF"

#read lib conf
#make new .lib

#export xxx
#source xxx

